---
title: "Computational Musicology"
author: "Maeve Boley"
date: "2024-02-21"
output: 
 flexdashboard::flex_dashboard:
  storyboard: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(spotifyr)
library(plotly)
library(ggplot2)
library(dplyr)
library(tidyverse)
library(compmus)
```

### New Tab 3: Variation Plot

```{r , echo=FALSE}

  PaulSimon<- get_playlist_audio_features("","2WzHYvLkaCRZDjsB04UfSE")|>
slice(1:30) |>
  add_audio_analysis() 
SimonAndGarfunkel<-get_playlist_audio_features("","22geZ3piYiEEYuvRoZ51op")|>
slice(1:30) |>
  add_audio_analysis() 

FullCorpus1<- bind_rows(
     SimonAndGarfunkel |> mutate(category = "Simon And Garfunkel"),
     PaulSimon |> mutate(category = "Paul Simon"))
  

FullCorpus1 |>
  mutate(sections = map(sections, summarise_at,vars(tempo, loudness, duration),                list(section_mean = mean, section_sd = sd))) |>
  unnest(sections) |>
  ggplot(aes(x = tempo, y = tempo_section_sd, colour = category, alpha = loudness)) +
  geom_point(aes(size = duration / 60)) +
  geom_rug() +
  theme_minimal() +
  ylim(0, 5) +
  labs(
    x = "Mean Tempo (bpm)",
    y = "SD Tempo",
    colour = "Genre",
    size = "Duration (min)",
    alpha = "Volume (dBFS)"
  )

```

***

Im not fully sure what to say about this yet however I am interested in the extreme outliers in this data set and in turn I hope to be able to make some type of connection explaining why they are all Simon and Garfunkel tracks. For this reason I feel I need to label outliers on this graph. I hope to be able to make better sense of the standard deviation component later!

### New Tab 2: Keys Histogram

```{r , echo=FALSE}
PaulSimon<- get_playlist_audio_features("","2WzHYvLkaCRZDjsB04UfSE")
SimonAndGarfunkel<-get_playlist_audio_features("","22geZ3piYiEEYuvRoZ51op")

FullCorpus1<- bind_rows(
     SimonAndGarfunkel |> mutate(category = "Simon And Garfunkel"),
     PaulSimon |> mutate(category = "Paul Simon"))

FullCorpus1 |>
  ggplot(aes(x = key_name)) +
  geom_bar() +
  facet_wrap(~category)

```

***

These keys histogram show a count of how many times each key was used in the corpus. These show that the two seperate groups are more alike than I may have predicted. Both groups have a lenancy towards keys G, D, E, and C. That being said G#, F, and A rank much higher with Paul Simon than Simon and Garfunkel. 

### New Tab 1: Chordogram

```{r , echo=FALSE}
 
 circshift <- function(v, n) {
  if (n == 0) v else c(tail(v, n), head(v, -n))
}

#      C     C#    D     Eb    E     F     F#    G     Ab    A     Bb    B
major_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    0,    0)
minor_chord <-
  c(   1,    0,    0,    1,    0,    0,    0,    1,    0,    0,    0,    0)
seventh_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    1,    0)

major_key <-
  c(6.35, 2.23, 3.48, 2.33, 4.38, 4.09, 2.52, 5.19, 2.39, 3.66, 2.29, 2.88)
minor_key <-
  c(6.33, 2.68, 3.52, 5.38, 2.60, 3.53, 2.54, 4.75, 3.98, 2.69, 3.34, 3.17)

chord_templates <-
  tribble(
    ~name, ~template,
    "Gb:7", circshift(seventh_chord, 6),
    "Gb:maj", circshift(major_chord, 6),
    "Bb:min", circshift(minor_chord, 10),
    "Db:maj", circshift(major_chord, 1),
    "F:min", circshift(minor_chord, 5),
    "Ab:7", circshift(seventh_chord, 8),
    "Ab:maj", circshift(major_chord, 8),
    "C:min", circshift(minor_chord, 0),
    "Eb:7", circshift(seventh_chord, 3),
    "Eb:maj", circshift(major_chord, 3),
    "G:min", circshift(minor_chord, 7),
    "Bb:7", circshift(seventh_chord, 10),
    "Bb:maj", circshift(major_chord, 10),
    "D:min", circshift(minor_chord, 2),
    "F:7", circshift(seventh_chord, 5),
    "F:maj", circshift(major_chord, 5),
    "A:min", circshift(minor_chord, 9),
    "C:7", circshift(seventh_chord, 0),
    "C:maj", circshift(major_chord, 0),
    "E:min", circshift(minor_chord, 4),
    "G:7", circshift(seventh_chord, 7),
    "G:maj", circshift(major_chord, 7),
    "B:min", circshift(minor_chord, 11),
    "D:7", circshift(seventh_chord, 2),
    "D:maj", circshift(major_chord, 2),
    "F#:min", circshift(minor_chord, 6),
    "A:7", circshift(seventh_chord, 9),
    "A:maj", circshift(major_chord, 9),
    "C#:min", circshift(minor_chord, 1),
    "E:7", circshift(seventh_chord, 4),
    "E:maj", circshift(major_chord, 4),
    "G#:min", circshift(minor_chord, 8),
    "B:7", circshift(seventh_chord, 11),
    "B:maj", circshift(major_chord, 11),
    "D#:min", circshift(minor_chord, 3)
  )

key_templates <-
  tribble(
    ~name, ~template,
    "Gb:maj", circshift(major_key, 6),
    "Bb:min", circshift(minor_key, 10),
    "Db:maj", circshift(major_key, 1),
    "F:min", circshift(minor_key, 5),
    "Ab:maj", circshift(major_key, 8),
    "C:min", circshift(minor_key, 0),
    "Eb:maj", circshift(major_key, 3),
    "G:min", circshift(minor_key, 7),
    "Bb:maj", circshift(major_key, 10),
    "D:min", circshift(minor_key, 2),
    "F:maj", circshift(major_key, 5),
    "A:min", circshift(minor_key, 9),
    "C:maj", circshift(major_key, 0),
    "E:min", circshift(minor_key, 4),
    "G:maj", circshift(major_key, 7),
    "B:min", circshift(minor_key, 11),
    "D:maj", circshift(major_key, 2),
    "F#:min", circshift(minor_key, 6),
    "A:maj", circshift(major_key, 9),
    "C#:min", circshift(minor_key, 1),
    "E:maj", circshift(major_key, 4),
    "G#:min", circshift(minor_key, 8),
    "B:maj", circshift(major_key, 11),
    "D#:min", circshift(minor_key, 3)
  )
  
 Insomniacs_Lullaby <-
  get_tidy_audio_analysis("2ImxX1NJBvgF0WthgOwAmR?si=fb0a38fa909848ee") |>
  compmus_align(sections, segments) |>
  select(sections) |>
  unnest(sections) |>
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "mean", norm = "manhattan"
      )
  ) 
   
Insomniacs_Lullaby |> 
  compmus_match_pitch_template(
    key_templates, 
    method = "euclidean",
    norm = "manhattan"     
  ) |>
  ggplot(
    aes(x = start + duration / 2, width = duration, y = name, fill = d)
  ) +
  geom_tile() +
  scale_fill_viridis_c(guide = "none") +
  theme_minimal() +
  labs(x = "Time (s)", y = "")
  
 
```

***

From this chordogram I would argue that majority of this track is in G major or or E minor. This is a very popular key amongst Paul Simons work. Additionally there is light green line in near the middle, and even brigter near the end where there are not only rests in the guitar and voice parts but also indicating another type of noise, perhaps computorized. This being said I will need to do further analysis when I better grasp the concept...


### Tab 1: Chromagram

```{r , echo=FALSE}
Bridgesong <-
     get_tidy_audio_analysis("0eGl5p2TAYt76pqjEvQPa2?si=4183b29e05264ea3") |>
     select(segments) |>
     unnest(segments) |>
     select(start, duration, pitches)
Bridgesong %>%
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) %>%
  compmus_gather_chroma() |> 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c()
```

***

A represenation of the chromatic features of The 59th Bridge Street Song by Simon and Garfunkel. 

### Tab 2 
```{r , echo=FALSE}
Bridgesong <-
  get_tidy_audio_analysis("0eGl5p2TAYt76pqjEvQPa2?si=4183b29e05264ea3") |> 
  compmus_align(bars, segments) |>                    
  select(bars) |>                                    
  unnest(bars) |>                                    
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "rms", norm = "euclidean"            
      )
  ) |>
  mutate(timbre = map(segments,compmus_summarise, timbre, method = "rms", norm = "euclidean"))

Bridgesong |>
  compmus_gather_timbre() |>
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = basis,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  scale_fill_viridis_c() +                              
  theme_classic()
```

***
no analysis yet...

### Tab 3: Timbre SSM

```{r , echo=FALSE}

Bridgesong <-
     get_tidy_audio_analysis("0eGl5p2TAYt76pqjEvQPa2?si=4183b29e05264ea3") |>
     select(segments) |>
     unnest(segments) |>
     select(start, duration, timbre)

Bridgesong |>
  compmus_self_similarity(timbre, "cosine") |> 
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  scale_fill_viridis_c(guide = "none") +
  theme_classic() +
  labs(x = "BridgeSong", y = "BridgeSong")
 
```

***

This is a self similarity matrice of Simon and Garfunkels hit, The 59th Bridge Street Song according to timbre. This song was chosen as to represnt a centerpoint. This shows a common theme of fade outs. In this graph it is hard to determine the amount of segments, particuarly towards the middle of the graph although I would say there are 4. 

### Tab 4: Pitches SSM

```{r , echo=FALSE}

Bridgesong <-
     get_tidy_audio_analysis("0eGl5p2TAYt76pqjEvQPa2?si=4183b29e05264ea3") |>
     select(segments) |>
     unnest(segments) |>
     select(start, duration, pitches)

Bridgesong |>
  compmus_self_similarity(pitches, "cosine") |> 
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  scale_fill_viridis_c(guide = "none") +
  theme_classic() +
  labs(x = "Bridgesong", y = "Bridgesong")
  
```

***

This is a self-similarity matrix on Simon and Garfunkel's hit The 59th Street Bridge Song based on pitches. 

### Introduction

This corpus will encompass the works of Simon and Garfunkel in addition to Paul Simon’s solo work in order to compare the two separate discographies. Paul Simon claims that throughout his time in Simon and Garfunkel the two artists had many creative differences that had to be compromised on however after Simon and Garfunkel parted ways Paul Simon went on to produce many albums of his own written work, now with full creative control. I am curious how these musical differences Paul Simon has alluded to will be measured by Spotify’s AI. Through using a computer to give us actual data about the works of Paul Simon and works of Simon and Garfunkel we can analyze the effect that Art Garfunkel had on the music produced as a band. One obvious difference I predict is a major change in timbre and volume between the two bodies of works as we are comparing two voices harmonizing in Simon and Garfunkel to a solo vocal of Paul Simon. In addition to this I expect timbre and duration will vary as instrumental solos and use of minor or uncommon keys and scales and rhythms were utilized more by Paul Simon in his solo career than as a duo. This being said tracks like “The Boxer”,”50 ways to lose a lover”,and “Somewhere They Cant Find Me” particularly interesting and useful to this analysis as these are fairly popular selections that I feel best represents the artists distinct musical styles. “Bridge Over Troubled Water” is reminiscent of Simon and Garfunkel styles and was a transition period for Paul Simon so comparing this piece of work to that of the duo’s should provide results heavily weighted on lack of harmonies rather than compositional style. In addition to this there will be other differences to account for as I plan for this corpus to be inclusive of as many different recordings of the artists performing their songs, including live recordings which will undoubtedly vary from their studio version matches.

### Visualization #1: Scatterplot

```{r, week1, echo=FALSE}
PaulSimon<- get_playlist_audio_features("","2WzHYvLkaCRZDjsB04UfSE")
SimonAndGarfunkel<-get_playlist_audio_features("","22geZ3piYiEEYuvRoZ51op")

FullCorpus1<- bind_rows(
     SimonAndGarfunkel |> mutate(category = "Simon And Garfunkel"),
     PaulSimon |> mutate(category = "Paul Simon")
)


FullCorpus1 |>
      ggplot(aes(x = valence, y = energy, color = category, size = loudness)) +  geom_point() +   geom_jitter() + geom_smooth()

```

```{r , echo=FALSE}
```

***

This scatterplot shows a representation of songs by the famous duo Simon and Garfunkel (shown in blue) compared to the solo work of Paul Simon (shown in red) in terms of valence (x-axsis), energy(y-axsis), and loudness(shown through size) as measured by Spotifys AI software. As predicted energy and valence have a positive coorelation regardless of artist similar to energys postive coorelation with loudness depicted on the chart. What I find interesting about this graph is that Paul Simons distribution seems fairly consistent while Simon and Garfunkel have more varation in loudness and energy. In addition I was suprised to see that there is a larger cluster of songs with lower valence in the Simon and Garfunkel songs than in Paul Simons. Generally speaking the highest levels of valence were achieved with energy levels of around 0.60-0.90.

### Visualization #2: Histogram
```{r, week1.1, echo=FALSE}
PaulSimon<- get_playlist_audio_features("","2WzHYvLkaCRZDjsB04UfSE")
SimonAndGarfunkel<-get_playlist_audio_features("","22geZ3piYiEEYuvRoZ51op")

FullCorpus1<- bind_rows(
     SimonAndGarfunkel |> mutate(category = "Simon And Garfunkel"),
     PaulSimon |> mutate(category = "Paul Simon")
)

FullCorpus1 |>
     ggplot(aes(x = energy)) +
     geom_histogram(binwidth = 0.1) +
     facet_wrap(~category)

```

***

This histogram broadly shows the amount of songs per each artist that match a certain level of energy in order to effectivly compare the energy levels of the two artists. 

```{r , echo=FALSE}
```
### Conclusions

This is where my general conclusions will appear once they have been made
